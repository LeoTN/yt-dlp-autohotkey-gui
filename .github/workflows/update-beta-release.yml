name: Update Latest Beta Release

on:
    push:
        branches: 
            - development

jobs:
    figure_out_release_version:
        runs-on: windows-latest
        outputs:
          id: version_id
          value: ${{ steps.set_latest_release_version_id.outputs.FINAL_BETA_VERSION }}

        steps:
            - name: Checkout Repository
              uses: actions/checkout@v2

            - name: Get Latest Release Version
              id: get_latest_release_version_id
              run: |
                $latestTag = git describe --tags --abbrev=0
                Write-Host "##vso[task.setvariable variable=latestTag]$latestTag"

            - name: Figure Out Beta Release Version
              id: set_latest_release_version_id
              run: |
                $currentVersion = [String]$env:latestTag
                $finalVersion = "0.0.0"
                if ($currentVersion -like "*-beta") {
                    $currentVersion = $currentVersion.Replace("-beta", "")  
                }
                $finalVersion = $currentVersion
                Write-Host "The beta version is $finalVersion"
                echo "FINAL_BETA_VERSION=$finalVersion" >> $GITHUB_ENV
    
    start_ci_workflow:
        permissions:
          contents: write
        uses: ./.github/workflows/build-installer-archive.yml
        with:
          version: ${{ needs.figure_out_release_version.outputs.version_id }}
          is_pre_release: true